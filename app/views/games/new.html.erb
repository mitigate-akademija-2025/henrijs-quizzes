<%= form_with url: quiz_games_path(@quiz), method: :post, class: "space-y-5" do %>
  <% @quiz.questions.each_with_index do |q, i| %>
    <% single = q.is_a?(ChoiceQuestion) && (q.max_selections.to_i == 1) %>

    <section class="rounded-2xl border border-gray-200 bg-white/90 p-5 shadow-sm backdrop-blur supports-[backdrop-filter]:bg-white/70">
      <!-- subtle top accent -->
      <div class="pointer-events-none -mx-5 -mt-5 mb-4 h-1 rounded-t-2xl bg-gradient-to-r from-blue-500/30 via-cyan-500/30 to-violet-500/30"></div>

      <% if q.image.attached? %>
        <div class="mb-4 overflow-hidden rounded-xl">
          <%= image_tag q.image,
                class: "block w-full max-h-64 object-cover",
                loading: "lazy",
                decoding: "async",
                alt: "" %>
        </div>
      <% end %>

      <header class="mb-3 flex items-start gap-3">
        <h2 class="flex-1 text-base font-semibold text-gray-900">
          <span class="mr-2 inline-block shrink-0 text-gray-500"><%= i + 1 %>.</span>
          <%= q.content %>
        </h2>

        <!-- Points chip -->
        <span class="ml-2 inline-flex items-center gap-1 rounded-full bg-gradient-to-br from-amber-50 to-orange-50 px-2.5 py-1 text-xs font-medium text-amber-800 ring-1 ring-inset ring-amber-200">
          ðŸ’Ž <span class="tabular-nums"><%= q.points %></span>
        </span>
      </header>

      <% if q.is_a?(ChoiceQuestion) %>
        <!-- small hint: single vs multi -->
        <p class="mb-2 text-xs text-gray-500">
          <%= single ? "Choose one answer" : "Select all that apply" %>
        </p>

        <div class="grid grid-cols-1 gap-2.5 sm:grid-cols-2">
          <% q.options.each do |opt| %>
            <label class="group relative flex cursor-pointer items-center rounded-xl border border-gray-200 bg-gray-50/70 px-3.5 py-3 text-gray-800 shadow-sm transition hover:bg-gray-100 focus-within:ring-2 focus-within:ring-blue-500/50">
              <% if single %>
                <input type="radio"
                       name="answers[<%= q.id %>]"
                       value="<%= opt.id %>"
                       class="peer absolute inset-0 h-full w-full cursor-pointer opacity-0">
              <% else %>
                <input type="checkbox"
                       name="answers[<%= q.id %>][]"
                       value="<%= opt.id %>"
                       class="peer absolute inset-0 h-full w-full cursor-pointer opacity-0">
              <% end %>

              <!-- custom indicator -->
              <span class="mr-3 grid h-5 w-5 place-items-center rounded-full border border-gray-300 bg-white transition
                           peer-checked:border-blue-600 peer-checked:bg-blue-600">
                <!-- checkmark -->
                <svg class="h-3 w-3 text-white opacity-0 transition peer-checked:opacity-100" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                  <path d="M20 6L9 17l-5-5"/>
                </svg>
              </span>

              <span class="flex-1"><%= opt.content %></span>
            </label>
          <% end %>
        </div>

      <% else %>
        <div class="mt-1">
          <label class="mb-1 block text-xs text-gray-500">Your answer</label>
          <div class="flex items-center gap-2 rounded-xl border border-gray-300 bg-white px-3 py-2 shadow-sm focus-within:ring-2 focus-within:ring-blue-500/50">
            <!-- keyboard icon -->
            <svg class="h-4.5 w-4.5 text-gray-400" viewBox="0 0 24 24" fill="none" aria-hidden="true">
              <rect x="3" y="7" width="18" height="10" rx="2" stroke="currentColor" stroke-width="1.5"/>
              <path d="M6 10h2M10 10h2M14 10h2M18 10h-1M6 13h5M12 13h6" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
            </svg>
            <input type="text"
                   name="text_answers[<%= q.id %>]"
                   class="w-full bg-transparent outline-none placeholder:text-gray-400"
                   autocomplete="off"
                   placeholder="Type your answerâ€¦">
          </div>
        </div>
      <% end %>
    </section>
  <% end %>

  <div class="sticky bottom-4 z-10 mt-6">
    <button class="mx-auto block w-full rounded-2xl bg-gradient-to-r from-blue-600 to-indigo-600 px-6 py-3 text-center text-white shadow-sm transition hover:brightness-110 focus:outline-none focus:ring-2 focus:ring-blue-500/60 sm:w-auto">
      <span class="inline-flex items-center gap-2">
        Submit
        <!-- arrow-right -->
        <svg class="h-4.5 w-4.5" viewBox="0 0 24 24" fill="none" aria-hidden="true">
          <path d="M5 12h14M13 5l7 7-7 7" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </span>
    </button>
  </div>
<% end %>
