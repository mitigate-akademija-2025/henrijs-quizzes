<% frame_id = local_assigns[:frame_id] || "profile_games" %>

<% if games.any? %>
  <div class="grid grid-cols-1 md:grid-cols-2 gap-3" data-controller="frame-links">
    <% games.each do |game| %>
      <% total    = game.quiz.questions.size %>
      <% score    = game.score || 0 %>
      <% percent  = total.positive? ? ((score.to_f / total) * 100).round : nil %>
      <% duration = (game.started_at && game.finished_at) ? distance_of_time_in_words(game.started_at, game.finished_at) : nil %>

      <article class="rounded-xl bg-white ring-1 ring-gray-200 p-4 transition hover:ring-gray-300 hover:shadow-sm">
        <div class="flex items-start justify-between gap-3">
          <div class="min-w-0">
            <%= link_to game.quiz.title, game_path(game),
                  data: { turbo_frame: "_top" },
                  class: "block truncate text-sm font-semibold text-gray-900 hover:text-indigo-600" %>

            <p class="mt-1 text-xs text-gray-500">
              by <%= game.quiz.user.username || "User" %>
              · finished <%= time_ago_in_words(game.finished_at) %> ago
              <% if duration %> · duration <%= duration %><% end %>
            </p>

            <% if percent %>
              <div class="mt-3">
                <div class="flex items-center justify-between text-[11px] text-gray-600">
                  <span>Result</span>
                  <span class="font-medium text-gray-700"><%= score %> / <%= total %></span>
                </div>
                <div class="mt-1 h-1.5 w-full rounded-full bg-gray-100">
                  <div class="h-full rounded-full bg-emerald-500" style="width:<%= percent %>%"></div>
                </div>
              </div>
            <% end %>
          </div>
        </div>
      </article>
    <% end %>
  </div>

  <div class="mt-5" data-frame-stay>
    <%= paginate games, params: { turbo_frame: frame_id } %>
  </div>
<% else %>
  <div class="rounded-xl border border-dashed border-gray-300 bg-white p-10 text-center shadow-sm" data-controller="frame-links">
    <h4 class="text-sm font-semibold text-gray-900">No completed games yet</h4>
    <p class="mt-1 text-xs text-gray-600">Find a cool quiz and compete with others.</p>
    <div class="mt-3">
      <%= link_to "Browse quizzes", quizzes_path,
            data: { turbo_frame: "_top" },
            class: "inline-block rounded-lg bg-gray-900 px-3.5 py-2 text-sm font-medium text-white hover:bg-black" %>
    </div>
  </div>
<% end %>
