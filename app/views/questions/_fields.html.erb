<% q_index = f.index || "NEW_Q" %>

<div data-question
     data-persisted="<%= f.object.persisted? %>"
     data-question-index="<%= q_index %>"
     data-option-index="<%= f.object.options.size %>"
     class="relative overflow-hidden w-full rounded-2xl border border-gray-200/70 bg-white/80 px-4 py-4 shadow-sm backdrop-blur supports-[backdrop-filter]:bg-white/60">

  <div class="pointer-events-none absolute inset-x-0 top-0 h-px bg-gradient-to-r from-blue-500/40 via-cyan-500/40 to-violet-500/40"></div>

  <%= f.hidden_field :id if f.object.persisted? %>
  <%= f.hidden_field :_destroy, value: "0", data: { role: "destroy-flag" } %>

  <div class="flex items-start gap-3">
    <span data-role="q-number" class="mt-2 w-6 text-right text-md font-semibold text-gray-500"></span>

    <%= f.text_field :content,
          placeholder: "Questionâ€¦",
          class: "w-full rounded-xl bg-white px-3 py-2.5 placeholder:text-gray-400 focus:outline-none " %>

    <div class="flex shrink-0 items-center gap-1.5">
      <button type="button"
              data-action="nested#addOption"
              class="inline-flex items-center rounded-lg border border-gray-200 bg-white px-2.5 py-2 text-gray-700 shadow-sm hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500/60"
              title="Add option" aria-label="Add option">
        <svg class="h-5 w-5" viewBox="0 0 24 24" fill="none" aria-hidden="true">
          <circle cx="12" cy="12" r="9" stroke="currentColor" stroke-width="1.5"/>
          <path d="M12 8v8M8 12h8" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
        </svg>
      </button>

      <button type="button"
              data-action="nested#removeQuestion"
              class="inline-flex items-center rounded-lg border border-gray-200 bg-white px-2.5 py-2 text-rose-600 shadow-sm hover:bg-rose-50 focus:outline-none focus:ring-2 focus:ring-rose-500/60"
              title="Remove question" aria-label="Remove question">
        <svg class="h-5 w-5" viewBox="0 0 24 24" fill="none" aria-hidden="true">
          <path d="M3 6h18M8 6V4h8v2M19 6l-1 14a2 2 0 0 1-2 2H8a2 2 0 0 1-2-2L5 6" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
          <path d="M10 11v6M14 11v6" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
        </svg>
      </button>
    </div>
  </div>

  <div class="mt-3 space-y-2" data-options-list>
    <% f.object.options.each_with_index do |option, j| %>
      <%= f.fields_for :options, option, child_index: j do |of| %>
        <%= render "options/fields", of: of %>
      <% end %>
    <% end %>
  </div>

  <template data-option-template>
    <%= f.fields_for :options, Option.new, child_index: "NEW_OPT" do |of| %>
      <%= render "options/fields", of: of %>
    <% end %>
  </template>
</div>
